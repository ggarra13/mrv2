#!/bin/bash
# SPDX-License-Identifier: BSD-3-Clause
# mrv2
# Copyright Contributors to the mrv2 Project. All rights reserved.

if [[ $BASH_SOURCE != $0 ]]; then
    dir=$BASH_SOURCE
else
    dir=$0
fi

export KERNEL=`uname`

symlink=`readlink ${dir}`

if [ "$symlink" != "" ]; then
    dir="$symlink"
    dir=${dir%/*}
else
    # Find directory where mrv2 bash script resides
    dir=${dir%/*}
fi

# If running from current directory, get full path
if [[ "$dir" == "." ]]; then
    dir=$PWD
fi


#
# Platform specific directory for mrV2
#
dir=${dir%/*}

#
# Add mrv2's lib directory first to LD_LIBRARY_PATH (Linux)
# or DYLD_FALLBACK_LIBRARY_PATH (macOS)
#
export LD_LIBRARY_PATH="${dir}/lib64:${dir}/lib:${LD_LIBRARY_PATH}:/usr/lib64:/usr/lib"
export DYLD_LIBRARY_PATH="${dir}/lib:${DYLD_LIBRARY_PATH}:/usr/local/lib:/usr/ib"
if [[ "@BUILD_PYTHON@" == "ON" ]]; then
    export PYTHONHOME="${dir}/"
    export PYTHONPATH="${dir}/lib/python@MRV2_PYTHON_VERSION@:${dir}/lib/python@MRV2_PYTHON_VERSION@/lib-dynload:${dir}/lib/python@MRV2_PYTHON_VERSION@/site-packages:${HOME}/.local/lib/python@MRV2_PYTHON_VERSION@/site_packages:${PYTHONPATH}"
fi

#
# Turn on/off explicit sync in Vulkan on Wayland.
# Explicit sync is more compatible with graphic cards and modern, but it is slower.
# Implicit sync is better for older graphic cards.
#
# Notes:  Vulkan NVidia stutters on implicit sync.
#
if [[ $KERNEL == *Linux* ]]; then
    if [[ -z $FLTK_VK_EXPLICIT_SYNC ]]; then
	export FLTK_VK_EXPLICIT_SYNC=0
    fi
    if [[ "@MRV2_BACKEND@" == "VK" ]]; then
	echo "        [vlk.] FLTK_VK_EXPLICIT_SYNC=${FLTK_VK_EXPLICIT_SYNC}"
    fi
fi



#
# Make Kwin use libdecor to allow dragging subwindows outside main window.
# This will make the title bar not follow the standard KDE look.
#
if [[ -z $LIBDECOR_FORCE_CSD ]]; then
    export LIBDECOR_FORCE_CSD=1
fi
